#							-*- Makefile -*-
# ParaStation
#
# Copyright (C) 2003,2004 ParTec AG, Karlsruhe
# Copyright (C) 2005-2007 ParTec Cluster Competence Center GmbH, Munich
#
# This file may be distributed under the terms of the Q Public License
# as defined in the file LICENSE.QPL included in the packaging of this
# file.
#
# Author:	Jens Hauke <hauke@par-tec.com>
#

# Use absolute paths !!!
SRCDIR := @abs_srcdir@
TOPSRCDIR := @abs_top_srcdir@
TOP_BUILDDIR:=@abs_top_builddir@
PSM_ENABLED:=@PSM_ENABLED@
PSM_INCLUDE_DIR:=@PSM_INCLUDE_DIR@
################################

export LIBNAME := pscom4psm
export LIBOBJS := pscom_psm.o
export LIBVPATH := $(SRCDIR)
export LIBINC = -I$(TOPSRCDIR)/include -I$(PSM_INCLUDE_DIR) -I$(SRCDIR)/../pscom
export LIBEXTERNAL_SHARED = -lpsm_infinipath
export LIBDSTDIR = ../..

################################

all lib: sharedlib

sharedlib: sharedlib.dir
	$(MAKE) -C $@.dir -f ../../Makefile.$@

sharedlib.dir:
	mkdir -p $@

clean:
	$(MAKE) -C sharedlib.dir -f ../../Makefile.sharedlib clean || echo nevermind

distclean:
	$(MAKE) -C sharedlib.dir -f ../../Makefile.sharedlib distclean || echo nevermind
	$(RM) -r sharedlib.dir
	$(RM) Makefile

Makefile: $(SRCDIR)/Makefile.in
	cd $(TOP_BUILDDIR); ./config.status
